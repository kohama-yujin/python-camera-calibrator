# カメラキャリブレーション（Python：OpenCV）

このツールは、PythonのOpenCVを用いてカメラキャリブレーションを行うツールです。

キャリブレーションには以下のようなチェスボードを使用します。
![チェスボード](./input.jpg)

## 環境
- Windows11
- Python 3.11.9
- NumPy 2.3.1
- OpenCV 4.11.0.86

## 概要
このツールで実現できることは以下の4つです。
- カメラキャリブレーション（内部パラメータの計算）
- カメラ姿勢推定（外部パラメータの推定）
- キャリブレーション結果の保存（.datファイル）
- 座標軸の描画
  
## 使用方法

### 1. 特徴点データの準備
特徴点データは`.dat`ファイルとして準備します。各行には、特徴点の座標や色、形状、半径を記載します。
- 先頭２列に座標（x, y）を記載
- その後ろに色、形状、半径を記載（順不同、省略可）
    > 細かい設定方法は「詳細な設定/色の設定方法」「詳細な設定/形状の設定方法」の項目を参照してください。
- 何も設定しない場合、デフォルトで`red circle 3px`が設定されます


#### 特徴点データの例
例 `points.dat`
```bash
100 100  
150 100 3px red circle  
100 150 #2bbaaf
150 150 green
200 200 5px
250 200 5px diamond
200 250 square black 5px
250 250 black square 5px
```

### 2. 画像の準備
特徴点を描画する対象となる画像を準備します。

このツールは、OpenCVの`cv2.imread`を使用して画像を読み込むため、さまざまな画像形式に対応しています。**詳細な対応形式についてはここでは記載しません**。対応形式に関しては、[OpenCV公式ドキュメント](https://docs.opencv.org)を参照してください。


### 3. 実行
実行時、以下のようなオプションを設定することができます（順不同、省略可）。

#### オプション一覧
| オプション | 説明 |
| :--- | :--- |
| -i    | 入力画像のパス(必須) |
| -p    | 特徴点データのパス(必須) |
| -o    | 出力画像のパス |
| -c    | 色の設定 |
| -s    | 形状の設定 |
| -r    | 半径の設定 |
| --shift | 画像の中心を原点とする場合 |

#### 実行例
以下のように実行して、特徴点を画像に描画します。
```bash
python3 main.py -i ./image/sample.png -p ./points_data/sample.dat
```
半径5pxの青い円を描画したい場合
```bash
python3 main.py -i ./image/sample.png -p ./points_data/sample.dat -r 5px -c blue -s circle
```
特徴点データの座標が画像の中心を原点としている場合
```bash
python3 main.py -i ./image/sample.png -p ./points_data/sample_shift.dat --shift
```
## 詳細な設定
### 優先順位
色、形状、半径を設定した場合の優先順位は以下のとおりです。

**デフォルトの設定**(`red circle 3px`) < **実行時のオプション設定** < **`.dat`内の設定**

### 色の設定方法
色は以下の方法で設定できます。
- 色名（例：`red`, `blue`, `green`）
- 16進数カラーコード（例：`#FF5733`, `#fff`）

色名は`color_options/colors.dat`にあるものが使用できます。ここに色名を追加すると、追加した色名での設定ができるようになります。

### 形状の設定方法
設定できる形状は以下の3つです。
- `circle`：円
- `square`：正方形
- `diamond`：ひし形
