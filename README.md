# カメラキャリブレーション（Python：OpenCV）

このツールは、PythonのOpenCVを用いてカメラキャリブレーションを行うツールです。  
キャリブレーションには以下のようなチェスボードを使用します。
![チェスボード](./input.jpg)

## 環境
- Windows11
- Python 3.11.9
- NumPy 2.3.1
- OpenCV 4.11.0.86

## 概要
このツールで実現できることは以下の4つです。
- カメラキャリブレーション（内部パラメータの計算）
- カメラ姿勢推定（外部パラメータの推定）
- キャリブレーション結果の保存（.datファイル）
- 座標軸の描画
  
## 使用方法
### 1. キャリブレーションパターンを用意
以下のようなキャリブレーションパターンの画像を10枚から20枚程度、用意します。  
正確なキャリブレーションを行うためには、様々な角度や距離からパターンを撮影することが推奨されます。﻿

<p float="left">
  <img src="./calib_images/WIN_20250710_13_56_05_Pro.jpg" width="30%" />
  <img src="./calib_images/WIN_20250710_13_56_27_Pro.jpg" width="30%" />
  <img src="./calib_images/WIN_20250710_13_57_14_Pro.jpg" width="30%" />
</p>

### 2. 実行
実行時、以下のようなオプションを設定します。**太字**は必須オプションです。

#### オプション一覧
| オプション（どちらでも良い） | 説明 |
| :--- | :--- |
| **-c, --cols** | **チェスボードの列数**（交点の数） |
| **-r, --rows** | **チェスボードの行数**（交点の数） |
| **-s, --square_size** | **マスの1辺の実際の長さ**（cm） |
| **-i, --image_dir** | **キャリブレーション画像のフォルダパス** |
| **-o, --save_dat_dir** | **キャリブレーション結果（.datファイル）を保存するフォルダパス** |
| --length | 描画する座標軸の長さ（cm）|
| --thickness | 描画する座標軸の太さ |

[1.キャリブレーションパターンを用意](#1-キャリブレーションパターンを用意)で紹介したチェスボードは`10×7`であるため、`-cols 9 -rows 6`となります。


#### 実行例
以下のように実行して、特徴点を画像に描画します。
```bash
python3 main.py -i ./image/sample.png -p ./points_data/sample.dat
```
半径5pxの青い円を描画したい場合
```bash
python3 main.py -i ./image/sample.png -p ./points_data/sample.dat -r 5px -c blue -s circle
```
特徴点データの座標が画像の中心を原点としている場合
```bash
python3 main.py -i ./image/sample.png -p ./points_data/sample_shift.dat --shift
```
## 詳細な設定
### 優先順位
色、形状、半径を設定した場合の優先順位は以下のとおりです。

**デフォルトの設定**(`red circle 3px`) < **実行時のオプション設定** < **`.dat`内の設定**

### 色の設定方法
色は以下の方法で設定できます。
- 色名（例：`red`, `blue`, `green`）
- 16進数カラーコード（例：`#FF5733`, `#fff`）

色名は`color_options/colors.dat`にあるものが使用できます。ここに色名を追加すると、追加した色名での設定ができるようになります。

### 形状の設定方法
設定できる形状は以下の3つです。
- `circle`：円
- `square`：正方形
- `diamond`：ひし形
